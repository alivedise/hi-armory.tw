<!DOCTYPE html>
<html lang="en" ng-app="wowApLevelApp" ng-strict-di>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>嗨... 英雄榜</title>

  <base href="/">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,400italic">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/angular-material/1.1.3/angular-material.min.css">
</head>
<body ng-controller="AppCtrl as $app" ng-cloak>

  <div class="r-page">
    <div class="c-container">
      <md-content layout-padding>
        <h1 class="md-display-2">嗨... 英雄榜</h1>

        <form ng-submit="$app.query($app.region, $app.realm, $app.character)">
          <div layout="row" layout-xs="column" layout-align="center center" layout-align-xs="start stretch">
            <md-input-container flex>
              <label>伺服器</label>
              <md-select ng-model="$app.realm">
                <md-option ng-repeat="realm in $app.REALMS[$app.region]" value="{{realm}}">
                  {{realm}}
                </md-option>
              </md-select>
            </md-input-container>
            <md-input-container flex>
              <label>角色名稱</label>
              <input ng-model="$app.character">
            </md-input-container>
            <md-button class="md-raised md-primary" type="search">查詢</md-button>
          </div>
        </form>
      </md-content>
    </div>

    <div class="c-results" ng-if="$app.profile">
      <div class="c-results__loading" layout="row" layout-align="space-around"
        layout-align-xs="center center"
        ng-if="
          !$app.profile.$resolved ||
            (
              !$app.profile.data &&
              ($app.profile.status != 'ready' && $app.profile.status != 'not found')
            )">
        <md-progress-circular class="md-warn md-hue-2" md-diameter="70"></md-progress-circular>
      </div> <!-- .c-results__loading -->
      <div class="c-results__content">
        <md-content layout-padding class="ng-anim"
          ng-if="
            $app.profile.$resolved &&
              ($app.pd || $app.profile.status == 'not found')">

          <!-- 角色資訊 card -->
          <md-card class="c-card md-whiteframe-5dp" ng-if="$app.pd"
            ng-class="'r' + $app.pd.race">

            <a ui-sref="index" class="c-card__close" hide show-xs><i class="fa fa-close"></i></a>

            <div class="md-card-image c-card__bg">
              <div class="c-card__bg__inner" ng-style="{backgroundImage: 'url('+ $app.pp.picture.profile +')'}"></div>
              <div class="c-card__bg__cover"></div>

              <div class="c-card__bg__content">
                <div class="c-card__name md-display-3">
                  {{$app.pd.name}}
                </div>
                <div class="c-card__meta">
                  <a ng-href="{{$app.pp.talentCalcLink}}" target="_blank"
                    class="s-class-color"
                    ng-class="'c' + $app.pd.class">{{$app.pp.talentName}}({{$app.pp.talentStr}}) {{$app.pp.className}}</a>
                </div>
              </div>
            </div> <!-- .c-card__bg -->

            <md-card-content>
              <div layout="row" layout-xs="column">
                <div flex="33" flex-xs="100">
                  <span class="md-body-1 c-card__fname">實裝</span>
                  <span class="c-card__fval">{{$app.pp.avgIlvEquipped}}</span>
                </div>
                <div flex="33" flex-xs="100">
                  <span class="md-body-1 c-card__fname">虛裝</span>
                  <span class="c-card__fval">{{$app.pp.avgIlv}}</span>
                </div>
                <div flex="33" flex-xs="100">
                  <span class="md-body-1 c-card__fname">神器裝等</span>
                  <span class="c-card__fval">{{$app.pp.artifactIlv}}</span>
                </div>
              </div>
              <div layout="row" layout-xs="column">
                <div flex="33" flex-xs="100">
                  <span class="md-body-1 c-card__fname">神器特質數</span>
                  <span class="c-card__fval">{{$app.pp.totalTraits}}</span>
                </div>
                <div flex="66" flex-xs="100">
                  <span class="md-body-1 c-card__fname">7.2 新神器特質</span>
                  <span class="c-card__fval">{{$app.pp.newTraitsUnlocked ? '已解鎖' : '未解鎖'}}</span>
                </div>
              </div>
              <div class="c-card__progress-row" layout="row" layout-xs="column" ng-repeat="raid in $app.pp.expStr track by $index">
                <div flex="33" flex-xs="100" layout-gt-xs="row" layout-align-gt-xs="start center">
                  <div class="md-body-1 c-card__fname" flex>{{raid.name}}經驗</div>
                </div>
                <div flex="66" flex-xs="100" layout-gt-xs="row" layout-align-gt-xs="start center">
                  <div class="c-card__fval" flex>{{raid.str}}</div>
                </div>
              </div>
            </md-card-content>
            <!-- <md-divider></md-divider> -->
            <div class="c-card__footer" layout="row" layout-xs="column">
              <div flex="33" flex-xs="50">
                英雄榜更新: <time-ago time="$app.pd.lastModified"></time-ago>
              </div>
              <div flex="33" flex-xs="50">
                資料抓取: <time-ago time="$app.profile.dataUpdatedAt"></time-ago>
              </div>
              <div flex="33" flex-xs="100">
                <div class="c-refresh">
                  <status-text status="$app.profile.status"
                    class="ng-anim"
                    ng-show="$app.profile.status !== 'ready'"></status-text>
                  <md-button class="md-fab md-mini md-hue-2" ng-click="$app.query($app.region, $app.realm, $app.character, { enqueue: true })"
                  ng-disabled="$app.profile.status !== 'ready'" aria-label="refresh"><i class="fa fa-refresh"
                    ng-class="{
                      'fa-spin': $app.profile.status !== 'ready'
                    }"></i></md-button>
                </div>
              </div>
            </div>
          </md-card>

          <!-- 查無角色 card -->
          <md-card class="c-card c-card--not-found md-whiteframe-5dp" ng-if="$app.profile.status == 'not found'">
            <a ui-sref="index" class="c-card__close" hide show-xs><i class="fa fa-close"></i></a>
            <md-card-title>
              <md-card-title-text>
                <span class="md-headline">查無此角色</span>
              </md-card-title-text>
            </md-card-title>
            <md-card-content>
              請再次確認 伺服器 跟 角色名稱 是否正確喔！
            </md-card-content>
          </md-card>
        </md-content>
      </div> <!-- .c-results__content -->
    </div> <!-- .c-results -->
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/locale/zh-tw.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.11/angular.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.11/angular-animate.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.11/angular-aria.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.11/angular-messages.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.4.2/angular-ui-router.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-material/1.1.3/angular-material.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.4.2/angular-ui-router.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/3.7.4/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/3.7.4/firebase-database.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angularFire/2.3.0/angularfire.min.js"></script>
  <script src="bundle.js"></script>
</body>
</html>
